# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

image: gitpod/workspace-full

tasks:
  - name: Setup Environment
    init: |
      conda create -n diffbir python=3.9 -y
      conda activate diffbir
      conda install pytorch==1.12.1 torchvision==0.13.1 cudatoolkit=11.3 -c pytorch -y
      conda install xformers==0.0.16 -c xformers -y
      pip install -r requirements.txt
    command: |
      mkdir -p weights
      cd weights
      wget https://huggingface.co/lxq007/DiffBIR/resolve/main/general_swinir_v1.ckpt
      wget https://huggingface.co/lxq007/DiffBIR/resolve/main/general_full_v1.ckpt
      wget https://huggingface.co/lxq007/DiffBIR/resolve/main/face_swinir_v1.ckpt
      wget https://huggingface.co/lxq007/DiffBIR/resolve/main/face_full_v1.ckpt
      cd ..
      python gradio_diffbir.py --ckpt weights/general_full_v1.ckpt --config configs/model/cldm.yaml --reload_swinir --swinir_ckpt weights/general_swinir_v1.ckpt

ports:
  - port: 7860
    onOpen: open-preview

